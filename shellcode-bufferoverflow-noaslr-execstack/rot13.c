#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <string.h>
#include <stdbool.h>

char* input_str;

int main(int argc, char** argv) {
  assert(argc > 1 && "Please provide a string to encode/decode");
  bool should_echo = false;
  bool should_write = false;


  if (argc >= 3) {
    if (argc == 4) {
      should_echo = (should_echo || strcmp(argv[2], "-e") == 0) || (strcmp(argv[2], "--echo") == 0);
      should_write = (should_write || strcmp(argv[2], "-w") == 0) || (strcmp(argv[2], "--write") == 0);
    }
    should_echo = (should_echo || strcmp(argv[1], "-e") == 0) || (strcmp(argv[1], "--echo") == 0);
    should_write = (should_write || strcmp(argv[1], "-w") == 0) || (strcmp(argv[1], "--write") == 0);
    input_str = argv[argc - 1];
  }
  else {
    input_str = argv[1];
  }

  char input_str_len = strlen(input_str);

  char original_str[input_str_len];
  if (should_echo) {
    strcpy(original_str, input_str);
  }
  char ch;
  for (int idx = 0; idx < input_str_len; idx++) {
    ch = input_str[idx];
    bool lower = (ch > 90);
    char base;

    if (lower)
      base = 'a';
    else
      base = 'A';

    ch = ((ch - base + 13) % 26) + base;
    input_str[idx] = ch;
  }

  if (should_echo)
    printf("original: %s\n", original_str);

  printf("%s\n", input_str);

  if (should_write) {
    char* cmd = "touch output";
    int result = system(cmd);
    assert(result == 0 && "cmd failed");
    FILE* fp = fopen("output", "w");
    fwrite(input_str, sizeof(char), input_str_len, fp);
    fclose(fp);
  }

  return 0;
}
